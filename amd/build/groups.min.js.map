{"version":3,"file":"groups.min.js","sources":["../src/groups.js"],"sourcesContent":["\r\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/fragment', 'core/templates', 'core/ajax'],\r\nfunction($, Str, Modal, ModalEvents, Fragment, Templates, AJAX) {\r\n\r\n    return {\r\n        init: function(contextID) {\r\n\r\n            var groupModal = document.getElementsByClassName('group-widget-viewmembers');\r\n            Array.from(groupModal).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    var target = e.target;\r\n                    var group = target.getAttribute('data-group');\r\n                    Modal.create({\r\n                        title: Str.get_string('groups', 'core')\r\n                    }).then(function(modal) {\r\n                        modal.show();\r\n                        var args = JSON.stringify({group: group});\r\n                        var params = {widget: 'groups', method: 'viewmembers', args: args};\r\n                        Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\r\n                            modal.setBody(html);\r\n                            Templates.runTemplateJS(js);\r\n                        });\r\n                        modal.getRoot().on(ModalEvents.hidden, function() {\r\n                            modal.destroy();\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n\r\n            var groupUsers = document.getElementsByClassName('add-group-users');\r\n            Array.from(groupUsers).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    var target = e.target;\r\n                    var group = target.getAttribute('data-group');\r\n                    Modal.create({\r\n                        type: Modal.types.SAVE_CANCEL,\r\n                        title: Str.get_string('widget:groups:adduser', 'block_dash'),\r\n                    }).then(function(modal) {\r\n                        modal.setLarge(true);\r\n                        modal.show();\r\n\r\n                        var args = JSON.stringify({group: group});\r\n                        var params = {widget: 'groups', method: 'addmembers', args: args};\r\n                        Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\r\n                            modal.setBody(html);\r\n\r\n                            modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                                form.addEventListener('submit', function(e) {\r\n                                    e.preventDefault();\r\n                                    var formdata = new FormData(e.target);\r\n                                    if (e.target.querySelector('[name=\"users[]\"]').value == '') {\r\n                                        return false;\r\n                                    }\r\n\r\n                                    var formdatastr = new URLSearchParams(formdata).toString();\r\n                                    var promises = AJAX.call([{\r\n                                        methodname: 'block_dash_groups_add_members',\r\n                                        args: {formdata: formdatastr}\r\n                                    }]);\r\n\r\n                                    promises[0].done((response) => {\r\n                                        if (response == true) {\r\n                                            window.location.reload();\r\n                                        } else {\r\n                                            // TODO: Error Notification.\r\n                                        }\r\n                                    });\r\n                                });\r\n                            });\r\n\r\n                            Templates.runTemplateJS(js);\r\n                        });\r\n\r\n                        modal.getRoot().on(ModalEvents.hidden, function() {\r\n                            modal.destroy();\r\n                        });\r\n\r\n                        // Apply and save method.\r\n                        modal.getRoot().on(ModalEvents.save, (e) => {\r\n                            e.preventDefault();\r\n                            modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                                form.querySelector('#id_submitbutton').click();\r\n                            });\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n\r\n            // Leave group.\r\n            var leaveGroupModal = document.getElementsByClassName('group-widget-leavegroup');\r\n            Array.from(leaveGroupModal).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    var target = e.target;\r\n                    var group = target.getAttribute('data-group');\r\n                    var groupname = target.getAttribute('data-groupname');\r\n\r\n                    Modal.create({\r\n                        type: Modal.types.SAVE_CANCEL,\r\n                        title: Str.get_string('groups', 'core' ),\r\n                    }).then(function(modal) {\r\n                        Str.get_string('confirm', 'core').then((html) => {\r\n                            modal.setSaveButtonText(html);\r\n                        });\r\n                        modal.show();\r\n\r\n                        Str.get_string('confirmleavegroup', 'block_dash', groupname).then((html) => {\r\n                            modal.setBody(html);\r\n                        });\r\n\r\n                        modal.getRoot().on(ModalEvents.save, (e) => {\r\n                            e.preventDefault();\r\n                            var promises = AJAX.call([{\r\n                                methodname: 'block_dash_groups_leave_group',\r\n                                args: {groupid: group}\r\n                            }]);\r\n\r\n                            promises[0].done((response) => {\r\n                                if (response == true) {\r\n                                    window.location.reload();\r\n                                } else {\r\n                                    // TODO: Error Notification.\r\n                                }\r\n                            });\r\n                        });\r\n\r\n                        modal.getRoot().on(ModalEvents.hidden, function() {\r\n                            modal.destroy();\r\n                        });\r\n\r\n                        modal.getRoot().on(ModalEvents.destroyed, function() {\r\n                            modal.remove();\r\n                            modal.attachmentPoint.remove();\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n\r\n            // Create group.\r\n            var createGroupModal = document.getElementsByClassName('create-group');\r\n            Array.from(createGroupModal).forEach(function(element) {\r\n                element.addEventListener('click', function(e) {\r\n                    e.preventDefault();\r\n                    Modal.create({\r\n                        type: Modal.types.SAVE_CANCEL,\r\n                        title: Str.get_string('groups', 'core'),\r\n                    }).then(function(modal) {\r\n                        modal.show();\r\n\r\n                        var args = \"\";\r\n                        var params = {widget: 'groups', method: 'creategroup', args: args};\r\n                        Fragment.loadFragment('block_dash', 'loadwidget', contextID, params).then((html, js) => {\r\n                            modal.setBody(html);\r\n                            Templates.runTemplateJS(js);\r\n                            modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                                form.addEventListener('submit', function(e) {\r\n                                    e.preventDefault();\r\n                                    var formdata = new FormData(e.target);\r\n                                    if (e.target.querySelector('[name=\"name\"]').value == \"\"\r\n                                        || e.target.querySelector('[name=\"courseid\"]').value == '') {\r\n                                        return false;\r\n                                    }\r\n                                    var formdatastr = new URLSearchParams(formdata).toString();\r\n                                    var promises = AJAX.call([{\r\n                                        methodname: 'block_dash_groups_create_group',\r\n                                        args: {formdata: formdatastr}\r\n                                    }]);\r\n\r\n                                    promises[0].done((response) => {\r\n                                        if (response == true) {\r\n                                            window.location.reload();\r\n                                        } else {\r\n                                            // TODO: Error Notification.\r\n                                        }\r\n                                    });\r\n                                });\r\n                            });\r\n                        });\r\n\r\n                        // Apply and save method.\r\n                        modal.getRoot().on(ModalEvents.save, (e) => {\r\n                            e.preventDefault();\r\n                            modal.getRoot().get(0).querySelectorAll('form').forEach(form => {\r\n                                form.querySelector('#id_submitbutton').click();\r\n                            });\r\n                        });\r\n\r\n                        modal.getRoot().on(ModalEvents.hidden, function() {\r\n                            modal.destroy();\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","Str","Modal","ModalEvents","Fragment","Templates","AJAX","init","contextID","groupModal","document","getElementsByClassName","Array","from","forEach","element","addEventListener","e","preventDefault","group","target","getAttribute","create","title","get_string","then","modal","show","params","widget","method","args","JSON","stringify","loadFragment","html","js","setBody","runTemplateJS","getRoot","on","hidden","destroy","groupUsers","type","types","SAVE_CANCEL","setLarge","get","querySelectorAll","form","formdata","FormData","querySelector","value","formdatastr","URLSearchParams","toString","call","methodname","done","response","window","location","reload","save","click","leaveGroupModal","groupname","setSaveButtonText","groupid","destroyed","remove","attachmentPoint","createGroupModal"],"mappings":"AACAA,2BAAO,CAAC,SAAU,WAAY,qBAAsB,oBAAqB,gBAAiB,iBAAkB,cAC5G,SAASC,EAAGC,IAAKC,MAAOC,YAAaC,SAAUC,UAAWC,YAE/C,CACHC,KAAM,SAASC,eAEPC,WAAaC,SAASC,uBAAuB,4BACjDC,MAAMC,KAAKJ,YAAYK,SAAQ,SAASC,SACpCA,QAAQC,iBAAiB,SAAS,SAASC,GACvCA,EAAEC,qBAEEC,MADSF,EAAEG,OACIC,aAAa,cAChCnB,MAAMoB,OAAO,CACTC,MAAOtB,IAAIuB,WAAW,SAAU,UACjCC,MAAK,SAASC,OACbA,MAAMC,WAEFC,OAAS,CAACC,OAAQ,SAAUC,OAAQ,cAAeC,KAD5CC,KAAKC,UAAU,CAACd,MAAOA,SAElCf,SAAS8B,aAAa,aAAc,aAAc1B,UAAWoB,QAAQH,MAAK,SAACU,KAAMC,IAC7EV,MAAMW,QAAQF,MACd9B,UAAUiC,cAAcF,OAE5BV,MAAMa,UAAUC,GAAGrC,YAAYsC,QAAQ,WACnCf,MAAMgB,0BAMlBC,WAAajC,SAASC,uBAAuB,mBACjDC,MAAMC,KAAK8B,YAAY7B,SAAQ,SAASC,SACpCA,QAAQC,iBAAiB,SAAS,SAASC,GACvCA,EAAEC,qBAEEC,MADSF,EAAEG,OACIC,aAAa,cAChCnB,MAAMoB,OAAO,CACTsB,KAAM1C,MAAM2C,MAAMC,YAClBvB,MAAOtB,IAAIuB,WAAW,wBAAyB,gBAChDC,MAAK,SAASC,OACbA,MAAMqB,UAAS,GACfrB,MAAMC,WAGFC,OAAS,CAACC,OAAQ,SAAUC,OAAQ,aAAcC,KAD3CC,KAAKC,UAAU,CAACd,MAAOA,SAElCf,SAAS8B,aAAa,aAAc,aAAc1B,UAAWoB,QAAQH,MAAK,SAACU,KAAMC,IAC7EV,MAAMW,QAAQF,MAEdT,MAAMa,UAAUS,IAAI,GAAGC,iBAAiB,QAAQnC,SAAQ,SAAAoC,MACpDA,KAAKlC,iBAAiB,UAAU,SAASC,GACrCA,EAAEC,qBACEiC,SAAW,IAAIC,SAASnC,EAAEG,WAC0B,IAApDH,EAAEG,OAAOiC,cAAc,oBAAoBC,aACpC,MAGPC,YAAc,IAAIC,gBAAgBL,UAAUM,WACjCnD,KAAKoD,KAAK,CAAC,CACtBC,WAAY,gCACZ5B,KAAM,CAACoB,SAAUI,gBAGZ,GAAGK,MAAK,SAACC,UACE,GAAZA,UACAC,OAAOC,SAASC,kBAQhC3D,UAAUiC,cAAcF,OAG5BV,MAAMa,UAAUC,GAAGrC,YAAYsC,QAAQ,WACnCf,MAAMgB,aAIVhB,MAAMa,UAAUC,GAAGrC,YAAY8D,MAAM,SAAChD,GAClCA,EAAEC,iBACFQ,MAAMa,UAAUS,IAAI,GAAGC,iBAAiB,QAAQnC,SAAQ,SAAAoC,MACpDA,KAAKG,cAAc,oBAAoBa,2BAQvDC,gBAAkBzD,SAASC,uBAAuB,2BACtDC,MAAMC,KAAKsD,iBAAiBrD,SAAQ,SAASC,SACzCA,QAAQC,iBAAiB,SAAS,SAASC,GACvCA,EAAEC,qBACEE,OAASH,EAAEG,OACXD,MAAQC,OAAOC,aAAa,cAC5B+C,UAAYhD,OAAOC,aAAa,kBAEpCnB,MAAMoB,OAAO,CACTsB,KAAM1C,MAAM2C,MAAMC,YAClBvB,MAAOtB,IAAIuB,WAAW,SAAU,UACjCC,MAAK,SAASC,OACbzB,IAAIuB,WAAW,UAAW,QAAQC,MAAK,SAACU,MACpCT,MAAM2C,kBAAkBlC,SAE5BT,MAAMC,OAEN1B,IAAIuB,WAAW,oBAAqB,aAAc4C,WAAW3C,MAAK,SAACU,MAC/DT,MAAMW,QAAQF,SAGlBT,MAAMa,UAAUC,GAAGrC,YAAY8D,MAAM,SAAChD,GAClCA,EAAEC,iBACaZ,KAAKoD,KAAK,CAAC,CACtBC,WAAY,gCACZ5B,KAAM,CAACuC,QAASnD,UAGX,GAAGyC,MAAK,SAACC,UACE,GAAZA,UACAC,OAAOC,SAASC,eAO5BtC,MAAMa,UAAUC,GAAGrC,YAAYsC,QAAQ,WACnCf,MAAMgB,aAGVhB,MAAMa,UAAUC,GAAGrC,YAAYoE,WAAW,WACtC7C,MAAM8C,SACN9C,MAAM+C,gBAAgBD,yBAOlCE,iBAAmBhE,SAASC,uBAAuB,gBACvDC,MAAMC,KAAK6D,kBAAkB5D,SAAQ,SAASC,SAC1CA,QAAQC,iBAAiB,SAAS,SAASC,GACvCA,EAAEC,iBACFhB,MAAMoB,OAAO,CACTsB,KAAM1C,MAAM2C,MAAMC,YAClBvB,MAAOtB,IAAIuB,WAAW,SAAU,UACjCC,MAAK,SAASC,OACbA,MAAMC,WAGFC,OAAS,CAACC,OAAQ,SAAUC,OAAQ,cAAeC,KAD5C,IAEX3B,SAAS8B,aAAa,aAAc,aAAc1B,UAAWoB,QAAQH,MAAK,SAACU,KAAMC,IAC7EV,MAAMW,QAAQF,MACd9B,UAAUiC,cAAcF,IACxBV,MAAMa,UAAUS,IAAI,GAAGC,iBAAiB,QAAQnC,SAAQ,SAAAoC,MACpDA,KAAKlC,iBAAiB,UAAU,SAASC,GACrCA,EAAEC,qBACEiC,SAAW,IAAIC,SAASnC,EAAEG,WACuB,IAAjDH,EAAEG,OAAOiC,cAAc,iBAAiBC,OACgB,IAArDrC,EAAEG,OAAOiC,cAAc,qBAAqBC,aACxC,MAEPC,YAAc,IAAIC,gBAAgBL,UAAUM,WACjCnD,KAAKoD,KAAK,CAAC,CACtBC,WAAY,iCACZ5B,KAAM,CAACoB,SAAUI,gBAGZ,GAAGK,MAAK,SAACC,UACE,GAAZA,UACAC,OAAOC,SAASC,qBAUpCtC,MAAMa,UAAUC,GAAGrC,YAAY8D,MAAM,SAAChD,GAClCA,EAAEC,iBACFQ,MAAMa,UAAUS,IAAI,GAAGC,iBAAiB,QAAQnC,SAAQ,SAAAoC,MACpDA,KAAKG,cAAc,oBAAoBa,cAI/CxC,MAAMa,UAAUC,GAAGrC,YAAYsC,QAAQ,WACnCf,MAAMgB"}