define ("block_dash/preferences_modal",["jquery","jqueryui","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","block_dash/select2"],function(a,b,c,d,e,f,g){var h=function(a,b,c){this.contextid=b;this.onCloseCallback=c;this.tab="";this.init(a)};h.prototype.modal=null;h.prototype.contextid=-1;h.prototype.init=function(b){var f=a(b);return c.get_string("editpreferences","block_dash").then(function(a){return d.create({type:d.types.DEFAULT,title:a,body:this.getBody()},f)}.bind(this)).then(function(b){var c=this;this.modal=b;this.modal.setLarge();this.modal.getRoot().on(e.shown,function(){this.modal.setBody(this.getBody())}.bind(this));this.modal.getRoot().on("change","#id_config_preferences_layout",this.submitFormAjax.bind(this,!1));this.modal.getRoot().on("click","[data-action=cancel]",function(){c.modal.hide()});this.modal.getRoot().on(e.save,this.submitForm.bind(this));this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this,!0));this.modal.getRoot().on(e.bodyRendered,function(){a("#fgroup_id_available_fields .form-inline > fieldset > div").sortable({items:".form-check-inline.fitem",handle:".drag-handle",axis:"y"});this.initSelect2()}.bind(this));this.modal.getRoot().on(e.hidden,function(a){window.onbeforeunload=null;if(this.onCloseCallback){this.onCloseCallback(a)}}.bind(this));this.modal.getRoot().on("click","[data-action=change-tab]",function(b){c.changeTab(a(b.target).data("tab"))});return this.modal}.bind(this))};h.prototype.changeTab=function(a){this.tab=a;this.submitFormAjax(!1)};h.prototype.getBody=function(a){if("undefined"==typeof a){a={}}var b={jsonformdata:JSON.stringify(a),tab:this.tab};return f.loadFragment("block_dash","block_preferences_form",this.contextid,b)};h.prototype.handleFormSubmissionResponse=function(a,b,c){if(c.validationerrors||!b){this.modal.setBody(this.getBody(a))}else if(b){this.modal.hide()}};h.prototype.handleFormSubmissionFailure=function(a){this.modal.setBody(this.getBody(a))};h.prototype.submitFormAjax=function(b,c){if(c){c.preventDefault()}var d=a.merge(this.modal.getRoot().find("[aria-invalid=\"true\"]"),this.modal.getRoot().find(".error"));if(d.length){d.first().focus();return}var e=this.modal.getRoot().find("form").serialize();g.call([{methodname:"block_dash_submit_preferences_form",args:{contextid:this.contextid,jsonformdata:JSON.stringify(e)},done:this.handleFormSubmissionResponse.bind(this,e,b),fail:this.handleFormSubmissionFailure.bind(this,e)}])};h.prototype.getModal=function(){return this.modal};h.prototype.submitForm=function(a){a.preventDefault();this.modal.getRoot().find("form").submit()};h.prototype.initSelect2=function(){this;this.modal.getRoot().find(".select2-form select").each(function(b,c){var d=null;if(a(c).find("option[value='-1']")){d={id:"-1",text:a(c).find("option[value='-1']").text()}}a(c).select2({dropdownParent:a(this).parent(),allowClear:!0,theme:"bootstrap4",placeholder:d}).on("select2:unselecting",function(){a(this).data("unselecting",!0)}).on("select2:opening",function(b){if(a(this).data("unselecting")){a(this).removeData("unselecting");b.preventDefault()}})})};return h});
//# sourceMappingURL=preferences_modal.min.js.map
